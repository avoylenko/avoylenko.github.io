{"openapi":"3.1.0","paths":{"/widget/conversations":{"post":{"operationId":"WidgetController_createConversation","parameters":[{"name":"website_token","required":true,"in":"query","schema":{"example":1,"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateConversationWidgetDto"}}}},"responses":{"200":{"description":"Success","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WidgetCreateConversationPayload"}}}},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"summary":"Create Conversation","tags":["Widget"]}},"/widget/conversations/{conversationId}":{"patch":{"operationId":"WidgetController_updateConversation","parameters":[{"name":"website_token","required":true,"in":"query","schema":{"example":1,"type":"string"}},{"name":"conversationId","required":true,"in":"path","schema":{"type":"number"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateConversationWidgetDto"}}}},"responses":{"200":{"description":"Success"},"400":{"description":"Invalid request payload"},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Conversation not found"},"500":{"description":"Internal server error"}},"summary":"Update Conversation","tags":["Widget"]},"get":{"operationId":"WidgetController_getConversation","parameters":[{"name":"conversationId","required":true,"in":"path","schema":{"example":1,"type":"string"}}],"responses":{"200":{"description":"Success","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WidgetConversationPayload"}}}},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"security":[{"auth-widget":[]}],"summary":"Get Conversation","tags":["Widget"]}},"/widget/conversations/{conversationId}/messages":{"post":{"operationId":"WidgetController_createMessage","parameters":[{"name":"website_token","required":true,"in":"query","schema":{"example":1,"type":"string"}},{"name":"conversationId","required":true,"in":"path","schema":{"example":1,"type":"string"}}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"type":"object","properties":{"attachments[]":{"type":"string","format":"binary"},"message":{"type":"object","properties":{"content":{"type":"string"},"echo_id":{"type":"string"}}},"contactId":{"type":"number"},"accountId":{"type":"number"},"conversationId":{"type":"number"}}}}}},"responses":{"200":{"description":""},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"security":[{"auth-widget":[]}],"summary":"Create Message","tags":["Widget"]},"get":{"operationId":"WidgetController_getMessages","parameters":[{"name":"conversationId","required":true,"in":"path","schema":{"example":1,"type":"string"}},{"name":"before","required":false,"in":"query","schema":{"example":20,"type":"string"}},{"name":"after","required":false,"in":"query","schema":{"example":10,"type":"string"}}],"responses":{"200":{"description":"Success","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/MessageData"}}}}},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"security":[{"auth-widget":[]}],"summary":"Get Messages","tags":["Widget"]}},"/widget/settings":{"get":{"operationId":"WidgetController_getSettings","parameters":[{"name":"website_token","required":true,"in":"query","schema":{"example":1,"type":"string"}}],"responses":{"200":{"description":"Success","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WidgetSettingsData"}}}},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"tags":["Widget"]}},"/widget/avatar/{conversationId}":{"get":{"operationId":"WidgetController_getAvatar","parameters":[{"name":"agentId","required":true,"in":"query","schema":{"example":1,"type":"string"}},{"name":"conversationId","required":true,"in":"path","schema":{"example":1,"type":"string"}}],"responses":{"200":{"description":"Success","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/WidgetGetAvatarPayload"}}}}},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"security":[{"auth-widget":[]}],"summary":"Get Agent Avatar URL","tags":["Widget"]}},"/widget/conversations/{conversationId}/messages/status":{"patch":{"operationId":"WidgetController_updateMessageStatus","parameters":[{"name":"conversationId","required":true,"in":"path","schema":{"example":1,"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateMessageStatusDto"}}}},"responses":{"200":{"description":"Success"},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"security":[{"auth-widget":[]}],"summary":"Update delivery status of the messages","tags":["Widget"]}},"/widget/click_info":{"post":{"operationId":"WidgetController_createClickInfo","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateClickIdDto"}}}},"responses":{"200":{"description":"Success","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WidgetClickIdDataClass"}}}},"400":{"description":"Validation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionBadRequest"}}}},"401":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionUnauthorized"}}}},"404":{"description":"Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionNotFound"}}}},"409":{"description":"ClickId is already exists","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionConflict"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExceptionInternalServerError"}}}}},"summary":"Save clickID and url to Redis","tags":["Widget"]}}},"info":{"title":"NovaTalks WebWidget API","description":"This is the WebWidget API documentation for NovaTalks","version":"1.0.0","contact":{"name":"NovaIT Support","url":"","email":"support@novait.com.ua"}},"tags":[],"servers":[],"components":{"securitySchemes":{"auth-widget":{"type":"apiKey","name":"auth-widget","in":"header"}},"schemas":{"ExceptionBadRequest":{"type":"object","properties":{"statusCode":{"type":"number","example":400},"message":{"type":"string","example":"Validation failed"},"error":{"type":"string","example":"Bad Request"}},"required":["statusCode","message","error"]},"ExceptionUnauthorized":{"type":"object","properties":{"statusCode":{"type":"number","example":401},"message":{"type":"string","example":"Unauthorized"},"error":{"type":"string","example":"Unauthorized"}},"required":["statusCode","message","error"]},"ExceptionNotFound":{"type":"object","properties":{"statusCode":{"type":"number","example":404},"message":{"type":"string","example":"Not Found"},"error":{"type":"string","example":"Not Found"}},"required":["statusCode","message","error"]},"ExceptionInternalServerError":{"type":"object","properties":{"statusCode":{"type":"number","example":500},"message":{"type":"string","example":"Internal Server Error"},"error":{"type":"string","example":"Internal Server Error"}},"required":["statusCode","message","error"]},"WidgetMessageDto":{"type":"object","properties":{"content":{"type":"string","description":"The content of the Message","example":"content"},"echo_id":{"type":"string","description":"The echo_id of the Message","example":"1234512"}},"required":["content","echo_id"]},"CreateConversationWidgetDto":{"type":"object","properties":{"name":{"type":"string","description":"The name of the Contact","example":"Agent 1"},"email":{"type":"string","maxLength":74,"format":"email","description":"The email of the Contact","example":"test@gmail.com"},"phone_number":{"type":"string","description":"The phone number of the Contact","example":"+1415555555"},"custom_attributes":{"type":"object","description":"The custom attributes of the Contact","example":{"key":"value"}},"additional_attributes":{"type":"object","description":"The additional attributes of the Contact","example":{"key":"value"}},"message":{"description":"The message of the Contact","allOf":[{"$ref":"#/components/schemas/WidgetMessageDto"}]}},"required":["name"]},"WidgetContactData":{"type":"object","properties":{"id":{"type":"number","description":"The ID of the Contact","example":1},"email":{"type":"string","description":"The email of the Contact","example":"test@gmail.com"},"name":{"type":"string","description":"The name of the Contact","example":"name"},"phone_number":{"type":"string","description":"The phone number of the Contact","example":"+1415555555"},"custom_attributes":{"type":"object","description":"The custom attributes of the Contact","example":{"key":"value"}}},"required":["id","email","name","phone_number","custom_attributes"]},"WidgetContactInboxData":{"type":"object","properties":{"pubsubToken":{"type":"string","description":"The pubsub token id of the Contact Inbox","example":"gNUBwlYpu0wT96O3YU4lwT"}},"required":["pubsubToken"]},"WidgetCreateConversationData":{"type":"object","properties":{"id":{"type":"number","description":"The Id of the Conversation","example":1}},"required":["id"]},"WidgetCreateConversationPayloadData":{"type":"object","properties":{"contact":{"description":"The contact of the Conversation","allOf":[{"$ref":"#/components/schemas/WidgetContactData"}]},"contactInbox":{"description":"The contact inbox","allOf":[{"$ref":"#/components/schemas/WidgetContactInboxData"}]},"account_id":{"type":"number","description":"The account Id of the Conversation","example":1},"conversation":{"description":"The payload of the Conversation","allOf":[{"$ref":"#/components/schemas/WidgetCreateConversationData"}]}},"required":["contact","contactInbox","account_id","conversation"]},"WidgetCreateConversationPayload":{"type":"object","properties":{"payload":{"description":"The payload of the Conversation","allOf":[{"$ref":"#/components/schemas/WidgetCreateConversationPayloadData"}]}},"required":["payload"]},"UpdateConversationWidgetDto":{"type":"object","properties":{"custom_attributes":{"type":"object","description":"The custom attributes of the Contact","example":{"key":"value"}}},"required":["custom_attributes"]},"WidgetConversationData":{"type":"object","properties":{"id":{"type":"number","description":"The Id of the Conversation","example":1},"contact_inbox_id":{"type":"number","description":"The contact inbox id of the Conversation","example":1}},"required":["id","contact_inbox_id"]},"SenderData":{"type":"object","properties":{"id":{"type":"number","description":"The id of the sender","example":1},"name":{"type":"string","description":"The name of the sender","example":"name"},"displayName":{"type":"string","description":"The display name of the sender","example":"display name"}},"required":["id","name","displayName"]},"MessageData":{"type":"object","properties":{"id":{"type":"number","description":"The Id of the Message","example":1},"content":{"type":"string","description":"The content of the Message","example":"content"},"account_id":{"type":"number","description":"The accountId of the Message","example":1},"inbox_id":{"type":"number","description":"The inboxId of the Message","example":1},"conversation_id":{"type":"number","description":"The conversationId of the Message","example":1},"dialog_id":{"type":"string","description":"The dialogId of the Message","example":"x1111xx1-11x1-1111-x1x1-1x1111x1xxx1"},"message_type":{"type":"string","description":"The messageType of the Message","example":"incoming","enum":["incoming","outgoing","activity","template"]},"private":{"type":"boolean","description":"The private of the Message","example":true},"pinned":{"type":"boolean","description":"Is pinned message","example":true},"status":{"type":"string","description":"The status of the Message","example":"delivered","enum":["sent","delivered","seen","failed"]},"source_id":{"type":"string","description":"The sourceId of the Message","example":"source_id"},"content_type":{"type":"string","description":"The content_type of the Message","enum":["text","input_text","input_textarea","input_email","input_select","cards","form","article","incoming_email","input_csat"],"example":"text"},"content_attributes":{"type":"object","description":"The content_attributes of the Message","example":{"testAttrKey":"testAttrValue"}},"sender_type":{"type":"string","description":"The sender_type of the Message","enum":["Contact","User","AgentBot"],"example":"User"},"sender_id":{"type":"number","description":"The sender_id of the Message","example":"sender_id"},"external_source_ids":{"type":"object","description":"The external_source_ids of the Message","example":{}},"created_at":{"type":"number","description":"The created_at of the Message","example":1673611023},"updated_at":{"type":"number","description":"The updated_at of the Message","example":1673611099},"attachments":{"type":"object","description":"The attachments of the Message","example":[]},"echo_id":{"type":"string","description":"The echo_id of the Message","example":"ccfd129e40a3"},"sender":{"description":"The sender of the Message","allOf":[{"$ref":"#/components/schemas/SenderData"}]}},"required":["id","content","account_id","inbox_id","conversation_id","dialog_id","message_type","private","pinned","status","source_id","content_type","content_attributes","sender_type","sender_id","external_source_ids","created_at","updated_at","attachments","echo_id","sender"]},"WidgetConversationPayload":{"type":"object","properties":{"conversation":{"description":"The payload of the Conversation","allOf":[{"$ref":"#/components/schemas/WidgetConversationData"}]},"messages":{"description":"The messages of the Conversation","type":"array","items":{"$ref":"#/components/schemas/MessageData"}}},"required":["conversation","messages"]},"Channel":{"type":"object","properties":{"hint":{"type":"string","description":"Hint for the channel","example":"telegram"},"name":{"type":"string","description":"Name of the channel","example":"asd"},"type":{"type":"string","description":"Type of the channel","example":"chat"},"enabled":{"type":"boolean","description":"Whether the channel is enabled","example":true},"url":{"type":"string","description":"URL for the channel","example":"http://t.me/url"}},"required":["hint","name","type","enabled"]},"AdditionalSettings":{"type":"object","properties":{"locale":{"type":"string","description":"Locale for the Widget","example":"en"},"channels":{"description":"List of channels","type":"array","items":{"$ref":"#/components/schemas/Channel"}},"isWidgetDynamic":{"type":"boolean","description":"Whether the widget is dynamic","example":true},"showCloseWidgetIcon":{"type":"boolean","description":"Whether to show close widget icon","example":true}},"required":["locale","channels","isWidgetDynamic","showCloseWidgetIcon"]},"PreChatFormOptions":{"type":"object","properties":{"calendar":{"type":"object","description":"Working hours info","example":{"timezone":"Europe/Kyiv","workingHours":[]}},"online":{"type":"object","description":"Online pre-chat options","example":{"enabled":true,"fields":[{"name":"name","key":"key","required":true}]}},"offline":{"type":"object","description":"Offline pre-chat options","example":{"enabled":true,"fields":[{"name":"name","key":"key","required":true}]}}},"required":["calendar","online","offline"]},"WidgetSettingsData":{"type":"object","properties":{"welcomeTitle":{"type":"string","description":"Title for the welcome message","example":"Title "},"widgetColor":{"type":"string","description":"Color of the widget","example":"#FF0866"},"preChatFormEnabled":{"type":"boolean","description":"Whether the pre-chat form is enabled","example":true},"additionalSettings":{"description":"Additional settings object","allOf":[{"$ref":"#/components/schemas/AdditionalSettings"}]},"preChatFormOptions":{"description":"Pre-chat form options object","allOf":[{"$ref":"#/components/schemas/PreChatFormOptions"}]}},"required":["welcomeTitle","widgetColor","preChatFormEnabled","additionalSettings","preChatFormOptions"]},"WidgetGetAvatarPayload":{"type":"object","properties":{"agent_id":{"type":"number","description":"The user Id of the Agent","example":1},"avatar_url":{"type":"string","description":"The avatar url of the Agent","example":"https//avatar.url.jpeg"}},"required":["agent_id","avatar_url"]},"UpdateMessageStatusDto":{"type":"object","properties":{"status":{"type":"string","description":"The message status to be changed to","example":"seen"},"messageIds":{"description":"The array of messages ids","example":"[1, 2]","type":"array","items":{"type":"number"}}},"required":["status","messageIds"]},"CreateClickIdDto":{"type":"object","properties":{"id":{"type":"string","pattern":"/^clickId_[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/","description":"The id","example":"clickId_003cf8de-b987-460c-9a16-7e13c099877f"},"url":{"type":"string","format":"uri","description":"The full url","example":"https://example.com?utm_source=source&utm_medium=medium&utm_campaign=campaing&utm_content=content&utm_term=term"},"website_token":{"type":"string","description":"The widget website token","example":"Dl6glOJ2KNjx7BpU4fyZl4"}},"required":["id","url","website_token"]},"Data":{"type":"object","properties":{"id":{"type":"string","description":"The click ID"},"url":{"type":"string","description":"The URL associated with the click ID"},"website_token":{"type":"string","description":"The widget channel token"}},"required":["id","url","website_token"]},"WidgetClickIdDataClass":{"type":"object","properties":{"message":{"type":"string","description":"Message of the result"},"data":{"description":"The returned payload value","allOf":[{"$ref":"#/components/schemas/Data"}]}},"required":["message","data"]},"ExceptionConflict":{"type":"object","properties":{"statusCode":{"type":"number","example":409},"message":{"type":"string","example":"Conflict"},"error":{"type":"string","example":"Conflict"},"conflictData":{"example":[{"id":519,"account_id":1,"contactName":"Diana"}],"type":"array","items":{"type":"string"}}},"required":["statusCode","message","error","conflictData"]}}}}
